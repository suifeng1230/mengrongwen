<{include file="weixin/lottery/block/header.html"}>
<{if $Dazpan.end == 1}>
    <div class="activity-lottery-end" >
    <div  class="main" >
    <div class="banner"><img src="
    <{if !$Dazpan.end_photo}>
    %THEME%/weixin/lottery/static/img/activity-lottery-end2.jpg
    <{else}>
    <{$pager.img}>/<{$item.end_photo}>
    <{/if}>
    " /></div>
    <div class="content" style=" margin-top:10px">
        <div class="boxcontent boxyellow">
            <div class="box">
                <div class="title-red">活动结束说明：</div>
                <div class="Detail">
                <p> <{$Dazpan.end_tips}></p>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
<{else}>
    <div style="display: none;" class="window" id="windowcenter">
	<div id="title" class="title">消息提醒<span class="close" id="alertclose"></span></div>
	<div class="content">
	 <div id="txt">亲，继续努力哦！</div>
	 <input value="确定" id="windowclosebutton" name="确定" class="txtbtn" type="button">	
	</div>
    </div>
    <{if $Dazpan.stime <time()}>
    <div id="outercont"  >
        <div id="outer-cont">
            <div id="outer"><img src="%THEME%/weixin/lottery/static/img/activity-lottery-5.png"></div>
        </div>
        <div id="inner-cont">
            <div id="inner" <{if $error}>onclick="alert('您不能参加此活动');"<{/if}>><img src="%THEME%/weixin/lottery/static/img/activity-lottery-2.png"></div>
        </div>
    </div>
    <{/if}>
<{/if}>


<div class="content">
    <div class="boxcontent boxyellow"  id="result"  <{if $Dazpan.end != 5}>style="display:none"<{/if}>>
    <div class="box">
        <div class="title-orange"><span>恭喜您中奖了</span></div>
        <div class="Detail">   
            <p>你中了：<span class="red" id="prizetype" ><{$Dazpan.prize}>等奖</span></p>
            <p>兑奖码：<span class="red" id="sncode" ><{$Dazpan.sn}></span></p>
           
        </div>
    </div>
  </div>


<{if $Dazpan.end == 5}>
 <div  class="main" style="display:none">
    <div class="content" style=" margin-top:10px">
        <div class="boxcontent boxyellow">
            <div class="box">
                <div class="title-red">恭喜:</div>
                <div class="Detail">
                <p>您已经中了<font color='red'><{$Dazpan.prize}> </font> ,您的领奖序列号:<font color='red'><{$Dazpan.sn}> </font>请您牢记及尽快与我们联系</p>
                </div>
            </div>
        </div>
    </div>
    </div>
<{/if}>


<{if $Dazpan.On == 1}>
<{if $error}>
<div class="boxcontent boxyellow">
    <div class="box">
    <div class="title-green"><span>友情提醒：</span></div>
         <div class="Detail">
				<p style="color:#f00;line-height:160%"><{$error}></p>            
        </div>
</div>
</div>
			<{/if}>
			
<div class="boxcontent boxyellow">
    <div class="box">
    <div class="title-green"><span>奖项设置：</span></div>
         <div class="Detail">
        
		 <p>每人最多允许抽奖次数:<{$Dazpan.max_num}><{if $Dazpan.daynums != 0}>，每天只能抽<{$Dazpan.daynums}>次<{/if}> <{if $Dazpan.usenums > 0}> - 已抽取 <span class="red" id="usenums"><{$Dazpan.usenums}></span> 次<{/if}></p>
            <p>一等奖: <{$Dazpan.fist}>  奖品数量: <{$Dazpan.fistnums}></p>
            <{if $Dazpan.second neq ''}>
                <p>二等奖: <{$Dazpan.second}> 奖品数量: <{$Dazpan.secondnums}></p>
              <{/if}>             
            <{if $Dazpan['third'] neq ''}>
                <p>三等奖: <{$Dazpan.third}> 奖品数量: <{$Dazpan.thirdnums}></p>
            <{/if}>
            <{if $Dazpan['four'] neq ''}>
                <p>四等奖: <{$Dazpan.four}>  奖品数量: <{$Dazpan.fournums}></p>
            <{/if}>
            <{if $Dazpan['five'] neq ''}>
                <p>五等奖: <{$Dazpan.five}>  奖品数量: <{$Dazpan.fivenums}></p>
            <{/if}>
            <{if $Dazpan['six'] neq ''}>
                <p>六等奖: <{$Dazpan.six}>   奖品数量: <{$Dazpan.sixnums}></p>
            <{/if}>
        </div>
</div>
</div>
<div class="boxcontent boxyellow">
    <div class="box">
        <div class="title-green">活动说明：</div>
        <div class="Detail">
        <p><{$Dazpan.info}></p>
        <p>活动时间:<{$Dazpan.stime|format:"Y-m-d"}>至<{$Dazpan.ltime|format:"Y-m-d"}></p>		
        <p><strong><{$Dazpan.txt}></strong></p>  
        </div>
    </div>
	
</div>
	<div style="margin-top:30px;text-align:center"><{$CONFIG.site.title}></div>
<{/if}>

</div>
<!--content end-->
</div>
<!--main end-->
<!--footer start-->
<style>
.footFix{width:100%;text-align:center;position:fixed;left:0;bottom:0;z-index:99;}
#footReturn a, #footReturn2 a {
display: block;
line-height: 41px;
color: #fff;
text-shadow: 1px 1px #282828;
font-size: 14px;
font-weight: bold;
}
#footReturn, #footReturn2 {
z-index: 89;
display: inline-block;
text-align: center;
text-decoration: none;
vertical-align: middle;
cursor: pointer;
width: 100%;
outline: 0 none;
overflow: visible;
Unknown property name.-moz-box-sizing: border-box;
box-sizing: border-box;
padding: 0;
height: 41px;
opacity: .95;
border-top: 1px solid #181818;
box-shadow: inset 0 1px 2px #b6b6b6;
background-color: #515151;
Invalid property value.background-image: -ms-linear-gradient(top,#838383,#202020);
background-image: -webkit-linear-gradient(top,#838383,#202020);
Invalid property value.background-image: -moz-linear-gradient(top,#838383,#202020);
Invalid property value.background-image: -o-linear-gradient(top,#838383,#202020);
background-image: -webkit-gradient(linear,0% 0,0% 100%,from(#838383),to(#202020));
Invalid property value.filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#838383',endColorstr='#202020');
Unknown property name.-ms-filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#838383',endColorstr='#202020');
}

</style>
<div style="height:60px;"></div>
<!--footer end-->

<script type="text/javascript">

    
$(function() {
    window.requestAnimFrame = (function() {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
        function(callback) {
            window.setTimeout(callback, 1000 / 60)
        }
    })();

    var totalDeg = 360 * 3 + 0;
    var steps = [];
    var lostDeg = [36, 96, 156, 216, 276,336];
    var prizeDeg = [6, 66, 126,186,246,306];
    var prize, sncode;
    var count = 0;
    var now = 0;
    var a = 0.01;
    var outter, inner, timer, running = false;
    

    function countSteps() {
        var t = Math.sqrt(2 * totalDeg / a);
        var v = a * t;
        for (var i = 0; i < t; i++) {
            steps.push((2 * v * i - a * i * i) / 2)
        }
        steps.push(totalDeg)
    }
     
    function step() {
    	 outter.style.webkitTransform = 'rotate(' + steps[now++] + 'deg)';
        outter.style.MozTransform = 'rotate(' + steps[now++] + 'deg)';
        if (now < steps.length) {
running = true;
            requestAnimFrame(step)
        } else {
            running = false;
            setTimeout(function() {
                if (prize != null) {
                    $("#sncode").text(sncode);
                    var type = "";
                    if (prize == 1) {
                        type = "一等奖"
                    } else if (prize == 2) {
                        type = "二等奖"
                    } else if (prize == 3) {
                    	type = "三等奖"
                    }
                    else if (prize == 4) {
                    	type = "四等奖"
                    }
                    else if (prize == 5) {
                    	type = "五等奖"
                    }
                    else if (prize == 6) {
                    	type = "六等奖"
                    }
                    $("#prizetype").text(type);
                    $("#result").slideToggle(500);
                    $("#outercont").slideUp(500)
                } else {
                    alert("<{$Dazpan.aginfo}>")
                }
            },
            200)
        }
    } //setps()
    
    function start(deg) {
        deg = deg || lostDeg[parseInt(lostDeg.length * Math.random())];
        running = true;
        clearInterval(timer);
        totalDeg = 360 * 5 + deg;
        steps = [];
        now = 0;
        countSteps();
        requestAnimFrame(step)
    }
    window.start = start;
    outter = document.getElementById('outer');
    inner = document.getElementById('inner');
    i = 10;

    $("#inner").click(function() {					 
        if (running){
			return;
		}
        if (count >= <{$Dazpan.max_num}> ) { 
            alert("Oh~No~您已经抽了<{$Dazpan.usenums}> 次奖,不能再抽了,下次再来吧!");
            return
        }

        if (prize != null) {  
            alert("亲，你不能再参加本次活动了喔！下次再来吧^_^");
            return
        }

       $.ajax({
         url     : "getajax?wx_id=<{$Dazpan.wx_id}>&id=<{$Dazpan.lid}>&rid=<{$Dazpan.rid}>",
         dataType: "json",
         
         beforeSend : function(){
            running = true;
            timer = setInterval(function() {
                i += 5;
                outter.style.webkitTransform = 'rotate(' + i + 'deg)';
                outter.style.MozTransform = 'rotate(' + i + 'deg)'
            },1)
         },
         success: function(data) {
         	if (data.error == 1) {
         		alert(data.msg);
         		count = <{$Dazpan.usenums}>;
         		clearInterval(timer);
         		return
         	}
         	if (data.error == "getsn") {

         		$("#tel").val(data.tel);
         		if(data.state==2){
         			$("#closedj").css("display","none");

         		}
         		$("#red").text(data.msg);
         		alert(data.msg + data.sn);
         		count = <{$Dazpan.usenums}>;
         		clearInterval(timer);
         		prize = data.prizetype;
         		sncode = data.sn;
         		start(prizeDeg[data.prizetype - 1]);
         		return
         	}
         	if (data.success) {
         		prize = data.prizetype;
         		sncode = data.sn;
         		start(prizeDeg[data.prizetype - 1])
         	} else {
         		prize = null;
         		start()
         	}
         	running = false;
         	count++
         },
         error: function() {
         	alert('ajax request failed!!!!');
         	return;
         	prize = null;
         	start();
         	running = false;
         	count++
         },
         timeout    : 5000       
        
       })//ajax
    }
    ) //#inner click function;
});


</script>
<script type="text/javascript">
window.shareData = {  
            "moduleName":"Lottery",
            "moduleID":"{weiqiye:$Dazpan.id}",

            "imgUrl": "{weiqiye:$Dazpan.starpicurl}", 
            "sendFriendLink": "{weiqiye:$f_siteUrl}{weiqiye::U('Lottery/index',array('token'=>$token,'id'=>$Dazpan['id'],'type'=>1))}",
            "tTitle": "{weiqiye:$Dazpan.title}",
            "tContent": ""
};
</script>
</body>
</html>